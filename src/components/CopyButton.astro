---
interface Props {
  content: string;
}

const { content } = Astro.props;
---

<div class="copy-button-wrapper">
  <button
    class="copy-button group flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 hover:bg-purple-600 hover:text-white rounded-lg border border-gray-200 dark:border-gray-600 transition-all duration-200"
    data-content={content}
  >
    <svg class="w-4 h-4 copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
    </svg>
    <svg class="w-4 h-4 check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
    </svg>
    <span class="button-text">Copy prompt</span>
  </button>
</div>

<script is:inline>
  document.querySelectorAll('.copy-button').forEach(button => {
    button.addEventListener('click', async () => {
      const content = button.getAttribute('data-content');
      const copyIcon = button.querySelector('.copy-icon');
      const checkIcon = button.querySelector('.check-icon');
      const buttonText = button.querySelector('.button-text');
      
      try {
        await navigator.clipboard.writeText(content);
        
        copyIcon.classList.add('hidden');
        checkIcon.classList.remove('hidden');
        buttonText.textContent = 'Copied!';
        button.classList.add('bg-green-500', 'text-white', 'border-green-500');
        
        setTimeout(() => {
          copyIcon.classList.remove('hidden');
          checkIcon.classList.add('hidden');
          buttonText.textContent = 'Copy prompt';
          button.classList.remove('bg-green-500', 'text-white', 'border-green-500');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
        buttonText.textContent = 'Failed';
        setTimeout(() => {
          buttonText.textContent = 'Copy prompt';
        }, 2000);
      }
    });
  });
</script>
